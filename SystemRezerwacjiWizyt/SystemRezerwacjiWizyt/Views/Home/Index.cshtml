@{
    ViewBag.Title = "Home Page";
    bool IsLogged;
    Person LoggedIn = null;
    if (Session["User"] == null)
    {
        IsLogged = false;
    }
    else
    {
        IsLogged = true;
        LoggedIn = (Person)Session["User"];
    }

}
@using System.Text
@using DatabaseAccess.Model
@model SystemRezerwacjiWizyt.Models.IndexHomeViewModels
@{
    var Speclist = Model.specs;
}
@*@{
        bool IsLogged;
        DatabaseAccess.Model.User LoggedIn = null;
        if (Session["User"] == null)
        {
            IsLogged = false;
        }
        else
        {
            IsLogged = true;
            LoggedIn = (DatabaseAccess.Model.User)Session["User"];
        }
    }*@

<div style="margin: 10px">
    @if (ViewBag.Message != null)
    {
        <h5 style="padding: 10px; background-color: bisque; margin-left: 0">@ViewBag.Message</h5>
    }
    @if (ViewBag.Error != null)
    {
        <h5 style="padding: 10px; background-color: salmon; margin-left: 0">@ViewBag.Error</h5>
    }
    <div style="display: inline-block">
        <table>
            <thead>
                <tr>
                    <th>Doktor</th>
                    <th>Specjalizacje</th>
                    <th>Średnia ocena</th>
                    <th>Pierwszy wolny termin</th>
                </tr>
            </thead>
            @foreach (var Doctor in Model.docs)
            {
                <tr>
                    <td style="font-weight: 600">@Doctor.User.Name.ToString()</td>
                    <td>
                        @foreach (var Spec in Doctor.Specialization)
                        {
                            @Spec.Name<br />
                        }
                    </td>
                    @{
                        var value = Doctor.AverageRate?.ToString();

                        if (value == null)
                        {
                            <td style="text-align: center">Brak ocen</td>
                        }
                        else
                        {
                            <td style="text-align: center">
                                @Html.ActionLink(@value, "ShowOpinions", "Opinion", new { id = @Doctor.Key }, new { target = "_blank" })
                            </td>
                        }
                    }
                    @{
                        var date = Doctor.FirstFreeSlot;
                        <td style="text-align: center">@date.ToString("d")<br />@date.ToString("t")</td>
                    }
                    @if (IsLogged && LoggedIn is Patient)
                    {
                        <td>
                            @Html.ActionLink("Zarezerwuj Wizyte",
                                "AddVisit",
                                "Visit",
                                new
                                {
                                    DoctorId = @Doctor.Key
                                },
                                null)
                        </td>
                    }
                </tr>
                        }
        </table>
    </div>

    <div style="display: inline-block; float: left">
        @using (Html.BeginForm("Search", "Home", FormMethod.Get))
        {
            <div class="form-group">
                <label class="control-label col-md-2">Specjalizacja: </label>
                @Html.DropDownListFor(m => m.SelSPec, new SelectList(Speclist, "Key", "Name", "0"), "Wybierz... ", new { @class = "form-control" })
            </div>
            <div class="form-group">
                <label class="control-label col-md-2">Nazwisko: </label>
                @Html.TextBoxFor(m => m.Text, new { @class = "form-control" })
            </div>
            <div class="form-group">
                <input type="submit" value="Szukaj" />
            </div>
            <div class="form-group">
                @Html.ActionLink("Resetuj filtry", "Search", "Home")
            </div>
        }
    </div>
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}